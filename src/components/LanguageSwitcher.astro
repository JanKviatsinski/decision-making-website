---
import { getRelativeLocaleUrl } from 'astro:i18n';
import { Icon }from 'astro-icon/components';

const languages = {
  en: 'English',
  pl: 'Polski',
  ru: 'Русский',
};

const currentLocale = (Astro.currentLocale || 'en') as keyof typeof languages;
---

<div class="relative language-switcher">
  <button class="language-switcher-button flex items-center gap-2 py-2 rounded-md cursor-pointer">
    <Icon name="mdi:web" size={24} />
    <span class="hidden sm:inline">{languages[currentLocale]}</span>
    <Icon name="mdi:chevron-down" size={24} />
  </button>
  <div class="language-switcher-menu absolute left-0 md:right-0 mt-0 w-48 rounded-md shadow-lg py-1 hidden ">
    {Object.entries(languages).map(([locale, name]) => (
      <a
        href={getRelativeLocaleUrl(locale)}
        class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
      >
        {name}
      </a>
    ))}
  </div>
</div>

<script>
  document.querySelectorAll('.language-switcher').forEach(switcher => {
    const button = switcher.querySelector('.language-switcher-button');
    const menu = switcher.querySelector('.language-switcher-menu');

    if (!button || !menu) return;

    button.addEventListener('click', (e) => {
      e.stopPropagation();
      menu.classList.toggle('hidden');
    });

    document.addEventListener('click', (e) => {
      if (!switcher.contains(e.target as Node)) {
        menu.classList.add('hidden');
      }
    });
  });
</script>